/** Generated by english-annotation-buster, Powered by Google Translate.**/
/*
 * Copyright 2002-2017 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * 版权所有2002-2017的原始作者或作者。 
 * 根据Apache许可证2.0版（"许可证"）获得许可； 
 * 除非遵守许可，否则不得使用此文件。 
 * 您可以在https://www.apache.org/licenses/LICENSE-2.0上获得许可的副本。 
 * 除非适用法律要求或以书面形式同意，否则根据"许可"分发的软件将按"现状"分发，没有任何明示或暗示的保证或条件。 
 * 有关许可下特定的语言管理权限和限制，请参阅许可。 
 * 
 */

package org.springframework.test.context;

import java.io.Serializable;
import java.util.Arrays;
import java.util.Collections;
import java.util.LinkedHashSet;
import java.util.Set;

import org.springframework.context.ApplicationContext;
import org.springframework.context.ApplicationContextInitializer;
import org.springframework.core.style.ToStringCreator;
import org.springframework.lang.Nullable;
import org.springframework.util.Assert;
import org.springframework.util.ObjectUtils;
import org.springframework.util.StringUtils;

/**
 * {@code MergedContextConfiguration} encapsulates the <em>merged</em>
 * context configuration declared on a test class and all of its superclasses
 * via {@link ContextConfiguration @ContextConfiguration},
 * {@link ActiveProfiles @ActiveProfiles}, and
 * {@link TestPropertySource @TestPropertySource}.
 *
 * <p>Merged context resource locations, annotated classes, active profiles,
 * property resource locations, and in-lined properties represent all declared
 * values in the test class hierarchy taking into consideration the semantics
 * of the {@link ContextConfiguration#inheritLocations},
 * {@link ActiveProfiles#inheritProfiles},
 * {@link TestPropertySource#inheritLocations}, and
 * {@link TestPropertySource#inheritProperties} flags.
 *
 * <p>A {@link SmartContextLoader} uses {@code MergedContextConfiguration}
 * to load an {@link org.springframework.context.ApplicationContext ApplicationContext}.
 *
 * <p>{@code MergedContextConfiguration} is also used by the
 * {@link org.springframework.test.context.cache.ContextCache ContextCache}
 * as the key for caching an
 * {@link org.springframework.context.ApplicationContext ApplicationContext}
 * that was loaded using properties of this {@code MergedContextConfiguration}.
 *
 * @author Sam Brannen
 * @author Phillip Webb
 * @since 3.1
 * @see ContextConfiguration
 * @see ContextHierarchy
 * @see ActiveProfiles
 * @see TestPropertySource
 * @see ContextConfigurationAttributes
 * @see SmartContextLoader#loadContext(MergedContextConfiguration)
 */
/**
 * {@code  MergedContextConfiguration}封装通过{@link  ContextConfiguration @ContextConfiguration}，{<@link> ActiveProfiles @ActiveProfiles}在测试类及其所有超类上声明的<em> merged </ em>上下文配置。 
 * 和{@link  TestPropertySource @TestPropertySource}。 
 *  <p>合并的上下文资源位置，带注释的类，活动配置文件，属性资源位置和内联属性表示测试类层次结构中所有声明的值，并考虑了{@link  ContextConfiguration＃inheritLocations}，{ @link  ActiveProfiles＃inheritProfiles}，{<@link> TestPropertySource＃inheritLocations}和{@link  TestPropertySource＃inheritProperties}标志。 
 *  <p> {<@link> SmartContextLoader}使用{@code  MergedContextConfiguration}加载{@link  org.springframework.context.ApplicationContext ApplicationContext}。 
 *  {@link  org.springframework.test.context.cache.ContextCache ContextCache}还使用<p> {<@code> MergedContextConfiguration}作为缓存{@link  org.springframework.context的密钥。 
 * 使用此{@code  MergedContextConfiguration}的属性加载的ApplicationContext ApplicationContext}。 
 *  @author  Sam Brannen @author  Phillip Webb @since 3.1以来
 */
public class MergedContextConfiguration implements Serializable {

	private static final long serialVersionUID = -3290560718464957422L;

	private static final String[] EMPTY_STRING_ARRAY = new String[0];

	private static final Class<?>[] EMPTY_CLASS_ARRAY = new Class<?>[0];

	private static final Set<Class<? extends ApplicationContextInitializer<?>>> EMPTY_INITIALIZER_CLASSES =
			Collections.<Class<? extends ApplicationContextInitializer<?>>> emptySet();

	private static final Set<ContextCustomizer> EMPTY_CONTEXT_CUSTOMIZERS = Collections.<ContextCustomizer> emptySet();


	private final Class<?> testClass;

	private final String[] locations;

	private final Class<?>[] classes;

	private final Set<Class<? extends ApplicationContextInitializer<?>>> contextInitializerClasses;

	private final String[] activeProfiles;

	private final String[] propertySourceLocations;

	private final String[] propertySourceProperties;

	private final Set<ContextCustomizer> contextCustomizers;

	private final ContextLoader contextLoader;

	@Nullable
	private final CacheAwareContextLoaderDelegate cacheAwareContextLoaderDelegate;

	@Nullable
	private final MergedContextConfiguration parent;


	/**
	 * Create a new {@code MergedContextConfiguration} instance for the
	 * supplied parameters.
	 * @param testClass the test class for which the configuration was merged
	 * @param locations the merged context resource locations
	 * @param classes the merged annotated classes
	 * @param activeProfiles the merged active bean definition profiles
	 * @param contextLoader the resolved {@code ContextLoader}
	 */
	/**
	 * 为提供的参数创建一个新的{@code  MergedContextConfiguration}实例。 
	 *  
	 * @param  testClass为其配置合并的测试类
	 * @param 位置合并上下文资源的位置
	 * @param 类别合并注释的类
	 * @param  activeProfiles合并的活动bean定义配置文件
	 * @param  contextLoader已解决{@code  ContextLoader}
	 */
	public MergedContextConfiguration(Class<?> testClass, String[] locations, Class<?>[] classes,
			String[] activeProfiles, ContextLoader contextLoader) {

		this(testClass, locations, classes, null, activeProfiles, contextLoader);
	}

	/**
	 * Create a new {@code MergedContextConfiguration} instance for the
	 * supplied parameters.
	 * @param testClass the test class for which the configuration was merged
	 * @param locations the merged context resource locations
	 * @param classes the merged annotated classes
	 * @param contextInitializerClasses the merged context initializer classes
	 * @param activeProfiles the merged active bean definition profiles
	 * @param contextLoader the resolved {@code ContextLoader}
	 */
	/**
	 * 为提供的参数创建一个新的{@code  MergedContextConfiguration}实例。 
	 *  
	 * @param  testClass为其配置合并的测试类
	 * @param 位置合并上下文资源的位置
	 * @param 合并注释的类的类
	 * @param  contextInitializerClasses合并上下文初始化器的类
	 * @param  activeProfiles合并的活动的bean定义配置文件
	 * @param  contextLoader已解析的{@code  ContextLoader}
	 */
	public MergedContextConfiguration(Class<?> testClass, String[] locations, Class<?>[] classes,
			@Nullable Set<Class<? extends ApplicationContextInitializer<?>>> contextInitializerClasses,
			String[] activeProfiles, ContextLoader contextLoader) {

		this(testClass, locations, classes, contextInitializerClasses, activeProfiles, contextLoader, null, null);
	}

	/**
	 * Create a new {@code MergedContextConfiguration} instance for the
	 * supplied parameters.
	 * @param testClass the test class for which the configuration was merged
	 * @param locations the merged context resource locations
	 * @param classes the merged annotated classes
	 * @param contextInitializerClasses the merged context initializer classes
	 * @param activeProfiles the merged active bean definition profiles
	 * @param contextLoader the resolved {@code ContextLoader}
	 * @param cacheAwareContextLoaderDelegate a cache-aware context loader
	 * delegate with which to retrieve the parent context
	 * @param parent the parent configuration or {@code null} if there is no parent
	 * @since 3.2.2
	 */
	/**
	 * 为提供的参数创建一个新的{@code  MergedContextConfiguration}实例。 
	 *  
	 * @param  testClass为其配置合并的测试类
	 * @param 位置合并上下文资源的位置
	 * @param 合并注释的类的类
	 * @param  contextInitializerClasses合并上下文初始化器的类
	 * @param  activeProfiles合并的活动的Bean定义配置文件
	 * @param  contextLoader已解决的{@code  ContextLoader} 
	 * @param  cacheAwareContextLoaderDelegate一个可感知缓存的上下文加载器委托，通过该委托检索父上下文
	 * @param 父配置或{<@code > null}，如果没有父级，则自3.2.2起
	 */
	public MergedContextConfiguration(Class<?> testClass, String[] locations, Class<?>[] classes,
			@Nullable Set<Class<? extends ApplicationContextInitializer<?>>> contextInitializerClasses,
			String[] activeProfiles, ContextLoader contextLoader,
			@Nullable CacheAwareContextLoaderDelegate cacheAwareContextLoaderDelegate,
			@Nullable MergedContextConfiguration parent) {

		this(testClass, locations, classes, contextInitializerClasses, activeProfiles, null, null,
				contextLoader, cacheAwareContextLoaderDelegate, parent);
	}

	/**
	 * Create a new {@code MergedContextConfiguration} instance by copying
	 * all fields from the supplied {@code MergedContextConfiguration}.
	 * @since 4.1
	 */
	/**
	 * 通过复制提供的{@code  MergedContextConfiguration}中的所有字段，创建一个新的{@code  MergedContextConfiguration}实例。 
	 *  @始于4.1
	 */
	public MergedContextConfiguration(MergedContextConfiguration mergedConfig) {
		this(mergedConfig.testClass, mergedConfig.locations, mergedConfig.classes,
				mergedConfig.contextInitializerClasses, mergedConfig.activeProfiles, mergedConfig.propertySourceLocations,
				mergedConfig.propertySourceProperties, mergedConfig.contextCustomizers,
				mergedConfig.contextLoader, mergedConfig.cacheAwareContextLoaderDelegate, mergedConfig.parent);
	}

	/**
	 * Create a new {@code MergedContextConfiguration} instance for the
	 * supplied parameters.
	 * <p>If a {@code null} value is supplied for {@code locations},
	 * {@code classes}, {@code activeProfiles}, {@code propertySourceLocations},
	 * or {@code propertySourceProperties} an empty array will be stored instead.
	 * If a {@code null} value is supplied for the
	 * {@code contextInitializerClasses} an empty set will be stored instead.
	 * Furthermore, active profiles will be sorted, and duplicate profiles
	 * will be removed.
	 * @param testClass the test class for which the configuration was merged
	 * @param locations the merged context resource locations
	 * @param classes the merged annotated classes
	 * @param contextInitializerClasses the merged context initializer classes
	 * @param activeProfiles the merged active bean definition profiles
	 * @param propertySourceLocations the merged {@code PropertySource} locations
	 * @param propertySourceProperties the merged {@code PropertySource} properties
	 * @param contextLoader the resolved {@code ContextLoader}
	 * @param cacheAwareContextLoaderDelegate a cache-aware context loader
	 * delegate with which to retrieve the parent context
	 * @param parent the parent configuration or {@code null} if there is no parent
	 * @since 4.1
	 */
	/**
	 * 为提供的参数创建一个新的{@code  MergedContextConfiguration}实例。 
	 *  <p>如果为{@code 位置}，{<@code>类}，{<@code> activeProfiles}，{<@code> propertySourceLocations}或{ @code  propertySourceProperties}将会存储一个空数组。 
	 * 如果为{@code  contextInitializerClasses}提供了一个{@code  null}值，则会存储一个空集。 
	 * 此外，将对活动配置文件进行排序，并删除重复的配置文件。 
	 *  
	 * @param  testClass为其配置合并的测试类
	 * @param 位置合并上下文资源的位置
	 * @param 合并注释的类的类
	 * @param  contextInitializerClasses合并上下文初始化器的类
	 * @param  activeProfiles合并的活动的Bean定义配置文件
	 * @param  propertySourceLocations合并的{@code  PropertySource}位置
	 * @param  propertySourceProperties合并的{@code  PropertySource}属性
	 * @param  contextLoader解析的{@code  ContextLoader} <
	 * @param> cacheAwareContextLoader委派一个可识别缓存的上下文加载器委托，用于从中检索父上下文
	 * @param 父级父级配置； 
	 * 如果没有父级@since，则返回{@code  null}
	 */
	public MergedContextConfiguration(Class<?> testClass, @Nullable String[] locations, @Nullable Class<?>[] classes,
			@Nullable Set<Class<? extends ApplicationContextInitializer<?>>> contextInitializerClasses,
			@Nullable String[] activeProfiles, @Nullable String[] propertySourceLocations,
			@Nullable String[] propertySourceProperties, ContextLoader contextLoader,
			@Nullable CacheAwareContextLoaderDelegate cacheAwareContextLoaderDelegate,
			@Nullable MergedContextConfiguration parent) {

		this(testClass, locations, classes, contextInitializerClasses, activeProfiles,
				propertySourceLocations, propertySourceProperties,
				EMPTY_CONTEXT_CUSTOMIZERS, contextLoader,
				cacheAwareContextLoaderDelegate, parent);
	}

	/**
	 * Create a new {@code MergedContextConfiguration} instance for the
	 * supplied parameters.
	 * <p>If a {@code null} value is supplied for {@code locations},
	 * {@code classes}, {@code activeProfiles}, {@code propertySourceLocations},
	 * or {@code propertySourceProperties} an empty array will be stored instead.
	 * If a {@code null} value is supplied for {@code contextInitializerClasses}
	 * or {@code contextCustomizers}, an empty set will be stored instead.
	 * Furthermore, active profiles will be sorted, and duplicate profiles
	 * will be removed.
	 * @param testClass the test class for which the configuration was merged
	 * @param locations the merged context resource locations
	 * @param classes the merged annotated classes
	 * @param contextInitializerClasses the merged context initializer classes
	 * @param activeProfiles the merged active bean definition profiles
	 * @param propertySourceLocations the merged {@code PropertySource} locations
	 * @param propertySourceProperties the merged {@code PropertySource} properties
	 * @param contextCustomizers the context customizers
	 * @param contextLoader the resolved {@code ContextLoader}
	 * @param cacheAwareContextLoaderDelegate a cache-aware context loader
	 * delegate with which to retrieve the parent context
	 * @param parent the parent configuration or {@code null} if there is no parent
	 * @since 4.3
	 */
	/**
	 * 为提供的参数创建一个新的{@code  MergedContextConfiguration}实例。 
	 *  <p>如果为{@code 位置}，{<@code>类}，{<@code> activeProfiles}，{<@code> propertySourceLocations}或{ @code  propertySourceProperties}将会存储一个空数组。 
	 * 如果为{@code  contextInitializerClasses}或{@code  contextCustomizers}提供了一个{@code  null}值，则将存储一个空集。 
	 * 此外，将对活动配置文件进行排序，并删除重复的配置文件。 
	 *  
	 * @param  testClass为其配置合并的测试类
	 * @param 位置合并上下文资源的位置
	 * @param 合并注释的类的类
	 * @param  contextInitializerClasses合并上下文初始化器的类
	 * @param  activeProfiles合并的活动bean定义配置文件
	 * @param  propertySourceLocations合并的{@code  PropertySource}位置
	 * @param  propertySourceProperties合并的{@code  PropertySource}属性
	 * @param  contextCustomizers上下文定制器
	 * @param  contextLoader解析的{ @code  ContextLoader} 
	 * @param  cacheAwareContextLoaderDelegate一个可识别缓存的上下文加载器委托，用于从中检索父上下文
	 * @param 父配置，如果没有父@，则{@code  null}
	 */
	public MergedContextConfiguration(Class<?> testClass, @Nullable String[] locations, @Nullable Class<?>[] classes,
			@Nullable Set<Class<? extends ApplicationContextInitializer<?>>> contextInitializerClasses,
			@Nullable String[] activeProfiles, @Nullable String[] propertySourceLocations,
			@Nullable String[] propertySourceProperties, @Nullable Set<ContextCustomizer> contextCustomizers,
			ContextLoader contextLoader, @Nullable CacheAwareContextLoaderDelegate cacheAwareContextLoaderDelegate,
			@Nullable MergedContextConfiguration parent) {

		this.testClass = testClass;
		this.locations = processStrings(locations);
		this.classes = processClasses(classes);
		this.contextInitializerClasses = processContextInitializerClasses(contextInitializerClasses);
		this.activeProfiles = processActiveProfiles(activeProfiles);
		this.propertySourceLocations = processStrings(propertySourceLocations);
		this.propertySourceProperties = processStrings(propertySourceProperties);
		this.contextCustomizers = processContextCustomizers(contextCustomizers);
		this.contextLoader = contextLoader;
		this.cacheAwareContextLoaderDelegate = cacheAwareContextLoaderDelegate;
		this.parent = parent;
	}


	/**
	 * Get the {@linkplain Class test class} associated with this
	 * {@code MergedContextConfiguration}.
	 */
	/**
	 * 获取与此{@code  MergedContextConfiguration}关联的{@link  plain Class测试类}。 
	 * 
	 */
	public Class<?> getTestClass() {
		return this.testClass;
	}

	/**
	 * Get the merged resource locations for {@code ApplicationContext}
	 * configuration files for the {@linkplain #getTestClass() test class}.
	 * <p>Context resource locations typically represent XML configuration
	 * files or Groovy scripts.
	 */
	/**
	 * 为{@link  plain #getTestClass（）测试类}获取{@code  ApplicationContext}配置文件的合并资源位置。 
	 *  <p>上下文资源位置通常代表XML配置文件或Groovy脚本。 
	 * 
	 */
	public String[] getLocations() {
		return this.locations;
	}

	/**
	 * Get the merged annotated classes for the {@linkplain #getTestClass() test class}.
	 */
	/**
	 * 获取{@link  plain #getTestClass（）测试类}的合并注释类。 
	 * 
	 */
	public Class<?>[] getClasses() {
		return this.classes;
	}

	/**
	 * Determine if this {@code MergedContextConfiguration} instance has
	 * path-based context resource locations.
	 * @return {@code true} if the {@link #getLocations() locations} array is not empty
	 * @since 4.0.4
	 * @see #hasResources()
	 * @see #hasClasses()
	 */
	/**
	 * 确定此{@code  MergedContextConfiguration}实例是否具有基于路径的上下文资源位置。 
	 *  
	 * @return  {@code  true}如果{@link  #getLocations（）位置}数组不为空@自4.0.4起
	 * @see  #hasResources（）
	 * @see  #hasClasses（）
	 */
	public boolean hasLocations() {
		return !ObjectUtils.isEmpty(getLocations());
	}

	/**
	 * Determine if this {@code MergedContextConfiguration} instance has
	 * class-based resources.
	 * @return {@code true} if the {@link #getClasses() classes} array is not empty
	 * @since 4.0.4
	 * @see #hasResources()
	 * @see #hasLocations()
	 */
	/**
	 * 确定此{@code  MergedContextConfiguration}实例是否具有基于类的资源。 
	 *  
	 * @return  {@code  true}如果{@link  #getClasses（）classes}数组不是空的@since 4.0.4 
	 * @see  #hasResources（）
	 * @see  #hasLocations（）
	 */
	public boolean hasClasses() {
		return !ObjectUtils.isEmpty(getClasses());
	}

	/**
	 * Determine if this {@code MergedContextConfiguration} instance has
	 * either path-based context resource locations or class-based resources.
	 * @return {@code true} if either the {@link #getLocations() locations}
	 * or the {@link #getClasses() classes} array is not empty
	 * @since 4.0.4
	 * @see #hasLocations()
	 * @see #hasClasses()
	 */
	/**
	 * 确定此{@code  MergedContextConfiguration}实例是否具有基于路径的上下文资源位置或基于类的资源。 
	 *  
	 * @return  {@code  true}，如果{@link  #getLocations（）位置}或{@link  #getClasses（）类}数组不为空@@4.0.4起<
	 * @see > #hasLocations（）
	 * @see  #hasClasses（）
	 */
	public boolean hasResources() {
		return (hasLocations() || hasClasses());
	}

	/**
	 * Get the merged {@code ApplicationContextInitializer} classes for the
	 * {@linkplain #getTestClass() test class}.
	 */
	/**
	 * 为{@link  plain #getTestClass（）测试类}获取合​​并的{@code  ApplicationContextInitializer}类。 
	 * 
	 */
	public Set<Class<? extends ApplicationContextInitializer<?>>> getContextInitializerClasses() {
		return this.contextInitializerClasses;
	}

	/**
	 * Get the merged active bean definition profiles for the
	 * {@linkplain #getTestClass() test class}.
	 * @see ActiveProfiles
	 */
	/**
	 * 获取{@link  plain #getTestClass（）测试类}的合并的活动bean定义配置文件。 
	 *  
	 * @see  ActiveProfiles
	 */
	public String[] getActiveProfiles() {
		return this.activeProfiles;
	}

	/**
	 * Get the merged resource locations for test {@code PropertySources}
	 * for the {@linkplain #getTestClass() test class}.
	 * @see TestPropertySource#locations
	 * @see java.util.Properties
	 */
	/**
	 * 获取{@link  plain #getTestClass（）测试类}的测试{@code  PropertySources}的合并资源位置。 
	 *  
	 * @see  TestPropertySource＃locations 
	 * @see  java.util.Properties
	 */
	public String[] getPropertySourceLocations() {
		return this.propertySourceLocations;
	}

	/**
	 * Get the merged test {@code PropertySource} properties for the
	 * {@linkplain #getTestClass() test class}.
	 * <p>Properties will be loaded into the {@code Environment}'s set of
	 * {@code PropertySources}.
	 * @see TestPropertySource#properties
	 * @see java.util.Properties
	 */
	/**
	 * 获取{@link  plain #getTestClass（）测试类}的合并测试{@code  PropertySource}属性。 
	 *  <p>属性将加载到{@code  Environment}的{@code  PropertySources}集中。 
	 *  
	 * @see  TestPropertySource＃properties 
	 * @see  java.util.Properties
	 */
	public String[] getPropertySourceProperties() {
		return this.propertySourceProperties;
	}

	/**
	 * Get the merged {@link ContextCustomizer ContextCustomizers} that will be applied
	 * when the application context is loaded.
	 */
	/**
	 * 获取合并的{@link  ContextCustomizer ContextCustomizers}，将在加载应用程序上下文时应用。 
	 * 
	 */
	public Set<ContextCustomizer> getContextCustomizers() {
		return this.contextCustomizers;
	}

	/**
	 * Get the resolved {@link ContextLoader} for the {@linkplain #getTestClass() test class}.
	 */
	/**
	 * 为{@link  plain #getTestClass（）测试类}获取已解析的{@link  ContextLoader}。 
	 * 
	 */
	public ContextLoader getContextLoader() {
		return this.contextLoader;
	}

	/**
	 * Get the {@link MergedContextConfiguration} for the parent application context
	 * in a context hierarchy.
	 * @return the parent configuration or {@code null} if there is no parent
	 * @see #getParentApplicationContext()
	 * @since 3.2.2
	 */
	/**
	 * 获取上下文层次结构中父应用程序上下文的{@link  MergedContextConfiguration}。 
	 *  
	 * @return 父配置，如果没有父配置，则为{@code  null} 
	 * @see  #getParentApplicationContext（）@since 3.2.2起
	 */
	@Nullable
	public MergedContextConfiguration getParent() {
		return this.parent;
	}

	/**
	 * Get the parent {@link ApplicationContext} for the context defined by this
	 * {@code MergedContextConfiguration} from the context cache.
	 * <p>If the parent context has not yet been loaded, it will be loaded, stored
	 * in the cache, and then returned.
	 * @return the parent {@code ApplicationContext} or {@code null} if there is no parent
	 * @see #getParent()
	 * @since 3.2.2
	 */
	/**
	 * 从上下文缓存中获取此{@code  MergedContextConfiguration}定义的上下文的父级{@link  ApplicationContext}。 
	 *  <p>如果尚未加载父上下文，则将其加载，存储在缓存中，然后返回。 
	 *  
	 * @return 父级{@code  ApplicationContext}或{<@@code> null}（如果没有父级）
	 * @see  #getParent（）@3.2.2起
	 */
	@Nullable
	public ApplicationContext getParentApplicationContext() {
		if (this.parent == null) {
			return null;
		}
		Assert.state(this.cacheAwareContextLoaderDelegate != null,
				"Cannot retrieve a parent application context without access to the CacheAwareContextLoaderDelegate");
		return this.cacheAwareContextLoaderDelegate.loadContext(this.parent);
	}


	/**
	 * Determine if the supplied object is equal to this {@code MergedContextConfiguration}
	 * instance by comparing both object's {@linkplain #getLocations() locations},
	 * {@linkplain #getClasses() annotated classes},
	 * {@linkplain #getContextInitializerClasses() context initializer classes},
	 * {@linkplain #getActiveProfiles() active profiles},
	 * {@linkplain #getPropertySourceLocations() property source locations},
	 * {@linkplain #getPropertySourceProperties() property source properties},
	 * {@linkplain #getParent() parents}, and the fully qualified names of their
	 * {@link #getContextLoader() ContextLoaders}.
	 */
	/**
	 * 通过比较两个对象的{@link  plain #getLocations（）位置}，{<@link> plain #getClasses（）注释的类}，{<>，确定所提供的对象是否与此{@code  MergedContextConfiguration}实例相等。 
	 *  @link> plain #getContextInitializerClasses（）上下文初始化程序类}，{<@link> plain #getActiveProfiles（）活动配置文件}，{<@link> plain #getPropertySourceLocations（）属性源位置}，{<@link> plain #getPropertySourceProperties （）属性源属性}，{<@link>普通#getParent（）父级}，以及其{@link  #getContextLoader（）ContextLoaders}的完全限定名称。 
	 * 
	 */
	@Override
	public boolean equals(@Nullable Object other) {
		if (this == other) {
			return true;
		}
		if (other == null || other.getClass() != getClass()) {
			return false;
		}

		MergedContextConfiguration otherConfig = (MergedContextConfiguration) other;
		if (!Arrays.equals(this.locations, otherConfig.locations)) {
			return false;
		}
		if (!Arrays.equals(this.classes, otherConfig.classes)) {
			return false;
		}
		if (!this.contextInitializerClasses.equals(otherConfig.contextInitializerClasses)) {
			return false;
		}
		if (!Arrays.equals(this.activeProfiles, otherConfig.activeProfiles)) {
			return false;
		}
		if (!Arrays.equals(this.propertySourceLocations, otherConfig.propertySourceLocations)) {
			return false;
		}
		if (!Arrays.equals(this.propertySourceProperties, otherConfig.propertySourceProperties)) {
			return false;
		}
		if (!this.contextCustomizers.equals(otherConfig.contextCustomizers)) {
			return false;
		}

		if (this.parent == null) {
			if (otherConfig.parent != null) {
				return false;
			}
		}
		else if (!this.parent.equals(otherConfig.parent)) {
			return false;
		}

		if (!nullSafeClassName(this.contextLoader).equals(nullSafeClassName(otherConfig.contextLoader))) {
			return false;
		}

		return true;
	}

	/**
	 * Generate a unique hash code for all properties of this
	 * {@code MergedContextConfiguration} excluding the
	 * {@linkplain #getTestClass() test class}.
	 */
	/**
	 * 为此{@code  MergedContextConfiguration}的所有属性生成唯一的哈希码，但不包括{@link  plain #getTestClass（）测试类}。 
	 * 
	 */
	@Override
	public int hashCode() {
		int result = Arrays.hashCode(this.locations);
		result = 31 * result + Arrays.hashCode(this.classes);
		result = 31 * result + this.contextInitializerClasses.hashCode();
		result = 31 * result + Arrays.hashCode(this.activeProfiles);
		result = 31 * result + Arrays.hashCode(this.propertySourceLocations);
		result = 31 * result + Arrays.hashCode(this.propertySourceProperties);
		result = 31 * result + this.contextCustomizers.hashCode();
		result = 31 * result + (this.parent != null ? this.parent.hashCode() : 0);
		result = 31 * result + nullSafeClassName(this.contextLoader).hashCode();
		return result;
	}

	/**
	 * Provide a String representation of the {@linkplain #getTestClass() test class},
	 * {@linkplain #getLocations() locations}, {@linkplain #getClasses() annotated classes},
	 * {@linkplain #getContextInitializerClasses() context initializer classes},
	 * {@linkplain #getActiveProfiles() active profiles},
	 * {@linkplain #getPropertySourceLocations() property source locations},
	 * {@linkplain #getPropertySourceProperties() property source properties},
	 * {@linkplain #getContextCustomizers() context customizers},
	 * the name of the {@link #getContextLoader() ContextLoader}, and the
	 * {@linkplain #getParent() parent configuration}.
	 */
	/**
	 * 提供{@link  plain #getTestClass（）测试类}，{<@link> plain #getLocations（）位置}，{<@link> plain #getClasses（）注释类}，{<@link> plain #getContextInitializerClasses（）上下文初始化程序类}，{<@link> plain #getActiveProfiles（）活动配置文件}，{<@link> plain #getPropertySourceLocations（）属性源位置}，{<@link> plain #getPropertySourceProperties（ ）属性源属性}，{<@link> plain #getContextCustomizers（）上下文定制器}，{<@link> #getContextLoader（）ContextLoader}的名称以及{@link  plain #getParent（）父配置}。 
	 * 
	 */
	@Override
	public String toString() {
		return new ToStringCreator(this)
				.append("testClass", this.testClass)
				.append("locations", ObjectUtils.nullSafeToString(this.locations))
				.append("classes", ObjectUtils.nullSafeToString(this.classes))
				.append("contextInitializerClasses", ObjectUtils.nullSafeToString(this.contextInitializerClasses))
				.append("activeProfiles", ObjectUtils.nullSafeToString(this.activeProfiles))
				.append("propertySourceLocations", ObjectUtils.nullSafeToString(this.propertySourceLocations))
				.append("propertySourceProperties", ObjectUtils.nullSafeToString(this.propertySourceProperties))
				.append("contextCustomizers", this.contextCustomizers)
				.append("contextLoader", nullSafeClassName(this.contextLoader))
				.append("parent", this.parent)
				.toString();
	}


	private static String[] processStrings(@Nullable String[] array) {
		return (array != null ? array : EMPTY_STRING_ARRAY);
	}

	private static Class<?>[] processClasses(@Nullable Class<?>[] classes) {
		return (classes != null ? classes : EMPTY_CLASS_ARRAY);
	}

	private static Set<Class<? extends ApplicationContextInitializer<?>>> processContextInitializerClasses(
			@Nullable Set<Class<? extends ApplicationContextInitializer<?>>> contextInitializerClasses) {

		return (contextInitializerClasses != null ?
				Collections.unmodifiableSet(contextInitializerClasses) : EMPTY_INITIALIZER_CLASSES);
	}

	private static Set<ContextCustomizer> processContextCustomizers(
			@Nullable Set<ContextCustomizer> contextCustomizers) {

		return (contextCustomizers != null ?
				Collections.unmodifiableSet(contextCustomizers) : EMPTY_CONTEXT_CUSTOMIZERS);
	}

	private static String[] processActiveProfiles(@Nullable String[] activeProfiles) {
		if (activeProfiles == null) {
			return EMPTY_STRING_ARRAY;
		}

		// Active profiles must be unique
		Set<String> profilesSet = new LinkedHashSet<>(Arrays.asList(activeProfiles));
		return StringUtils.toStringArray(profilesSet);
	}

	/**
	 * Generate a null-safe {@link String} representation of the supplied
	 * {@link ContextLoader} based solely on the fully qualified name of the
	 * loader or &quot;null&quot; if the supplied loader is {@code null}.
	 */
	/**
	 * 仅根据加载程序的完全限定名称或提供的{null}（如果提供的加载程序为{@code  null}，则仅基于加载程序的完全限定名称）为提供的{@link  ContextLoader}生成一个空安全的{@link  String}表示形式。 
	 * 
	 */
	protected static String nullSafeClassName(@Nullable ContextLoader contextLoader) {
		return (contextLoader != null ? contextLoader.getClass().getName() : "null");
	}

}
